- name: Config DNS server
  hosts: centos7
  remote_user: root

  tasks:
  - name: edit security options in /etc/named.conf
    ansible.builtin.yum:
      name: bind
      state: latest

  - name: install epel-release
    yum:
      name: epel-release
      state: latest

  - name: new file
    file:
      path: "~/text.txt"
      state: touch

  - name: new file with content
    copy:
      dest: "~/text.txt"
      content: |
        this is test
        this is test2

  - name: disable SELinux
    ansible.builtin.replaces:
      path: /etc/sysconfig/selinux
      regexp: 'SELINUX=enforcing'
      replaces: "SELINUX=disabled'

  - name: edit ssh authentication
    ansible.builtin.replace:
      path: /etc/ssh/sshd_config
      regexp: '#PermitRootLogin yes'
      replace: 'PermitRootLogin yes'

  - name: reload SSH
    command: systemctl restart sshd

  - name: add dns rule permanently
    firewalld:
      service: dns
      permanent: yes
      state: enabled

  - name: add port 53/tcp
    firewalld:
      port: 53/tcp
      permanent: yes
      state: enabled

  - name: add port 53/udp
    firewalld:
      port: 53/udp
      permanent: yes
      state: enabled

  - name: reload firewall
    command: firewall-cmd --reload
  
  - name: replace ip of DNS allow-list
    ansible.builtin.replace:
      path: /etc/named.conf
      regexp: '103.82.116.0/24'
      replace: '103.82.116.0/22'
